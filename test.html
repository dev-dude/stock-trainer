<html><head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Highcharts Demo</title>
  </head>
  <body>
      <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script src="https://code.highcharts.com/stock/highstock.js"></script>
  <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/stock/modules/export-data.js"></script>
  <script src="https://momentjs.com/downloads/moment.min.js"></script>

  
  <div id="container" style="height: 400px; min-width: 310px"></div>
    <!-- TODO: Missing CoffeeScript 2 -->
  <div id="allSaves"></div>
    <script type="text/javascript">
  
  
      
  
  let csvData;
  let allSaves = [];
  $.getJSON('http://localhost:3000/', function (data) {


      csvData = data;
      // Create the chart
      Highcharts.stockChart('container', {
  
  
          rangeSelector: {
              selected: 1
          },
          yAxis: [{ // Primary yAxis
                labels: {
                    format: 'a',
                    style: {
                        color: Highcharts.getOptions().colors[2]
                    }
                },
                title: {
                    text: '{value}',
                    style: {
                        color: Highcharts.getOptions().colors[2]
                    }
                },
                opposite: true

            }, { 
            gridLineWidth: 0,
            title: {
                text: 'b',
                style: {
                    color: Highcharts.getOptions().colors[0]
                }
            },
            labels: {
                format: '{value}',
                style: {
                    color: Highcharts.getOptions().colors[0]
                }
            }
        }

    ],
  
          title: {
              text: 'test'
          },
          plotOptions: {
                series: {
                    cursor: 'pointer',
                    point: {
                        events: {
                            click: function () {
                                let timestamp = moment.unix(this.category/1000);
                                let backObj = {value:this.y,time:timestamp.format("M/D/Y")};
                                $.post('http://localhost:3000/save', backObj, function(response) {
                                    let responseCopy = Object.assign({}, response);
                                    console.log(responseCopy);
                                    allSaves.unshift(responseCopy);     
                                    let items = "";
                                    let i = 0;
                                    for (;i < allSaves.length; i++) {
                                        console.log(allSaves[i].timestamp);
                                        let val = parseFloat(allSaves[i].value);
                                        let lastClick =  allSaves[i].isBuy ? "buy" : "sell";
                                        items +=  allSaves[i].data[0] + "-" + parseFloat(allSaves[i].data[4]).toFixed(2) + "- Last Click - " + lastClick + "<br>";
                                    }
                                    $("#allSaves").html(items);
                                }, 'json');
                            }
                        }
                    }
                }
            },
          series: [{
              name: 'ticker',
              yAxis:0,
              data: data.csvData,
              tooltip: {
                  valueDecimals: 2
              }
          },
          {
              name: 'rsi',
              lineWidth:.5,
              yAxis:1,
              dashStyle: 'longdash',
              color: 'grey',
              data: data.rsiData,
              tooltip: {
                  valueDecimals: 2
              }
          }]
      });
  });
  
  
  
  
  </script>

  
  
  </body></html>